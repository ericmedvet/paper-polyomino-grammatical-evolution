$stringF = f.format(
  of = f.fittedGrid();
  format = "{%d;%d}{%s}";  
  functions = [
    f.gridFitW();
    f.gridFitH();
    f.gridString(
      elementF = f.toString();
      byRows = true;
      yMirror = true
    )
  ]
)

$consoleL = ea.l.console(
  eFunctions = [
    ea.f.size(of = ea.f.genotype(of = ea.f.best()); format = "%3d");
    ea.f.quality(of = ea.f.best(); format = "%6.2f");
    ea.f.hist(of = f.each(of = ea.f.all(); mapF = ea.f.quality()));
    f.gridCount(of = ea.f.solution(of = ea.f.best()));
    f.gridW(of = ea.f.solution(of = ea.f.best()));
    f.gridH(of = ea.f.solution(of = ea.f.best()))
  ];
  kFunctions = [
    f.mappableKey(key = "problem.target");
    f.mappableKey(key = "solver.mapper.grammar.name")
  ];
  onlyLast = true
)

$fitnessProgessionP = ea.l.savePlotAndCsvForExp(
  path = $basePath + "best-fitness." + $imgType;
  plot = ea.plot.multi.quality(
    xSubplot = f.interpolated(name = target; s = "{problem.target}");
    ySubplot = f.interpolated(name = ea; s = "{solver.name}");
    line = f.interpolated(name = grammar; s = "{solver.mapper.grammar.name}")
  );
  type = $imgType
)

$sizeProgessionP = ea.l.savePlotAndCsvForExp(
  path = $basePath + "best-size." + $imgType;
  plot = ea.plot.multi.xyExp(
    xSubplot = f.interpolated(name = target; s = "{problem.target}");
    ySubplot = f.interpolated(name = ea; s = "{solver.name}");
    line = f.interpolated(name = grammar; s = "{solver.mapper.grammar.name}");
    y = f.gridCount(of = ea.f.solution(of = ea.f.best()))
  );
  type = $imgType
)

$fitnessBoxplotP = ea.l.savePlotAndCsvForExp(
  path = $basePath + "best-fitness-final." + $imgType;
  plot = ea.plot.multi.qualityBoxplot(
    xSubplot = f.interpolated(name = target; s = "{problem.target}");
    ySubplot = f.interpolated(name = ea; s = "{solver.name}");
    box = f.interpolated(name = grammar; s = "{solver.mapper.grammar.name}")
  );
  configuration = viz.plot.conf.image(axesShow = all; axesIndependences = [all]);
  type = $imgType
)

$archiveP = ea.l.savePlotAndCsvForRun(
  path = $basePath + "{solver.name}/{problem.target}/me-archive-{solver.mapper.grammar.name}-{randomGenerator.seed:%03d}." + $imgType;
  plot = ea.plot.single.me();
  kCondition = predicate.matches(f = f.mappableKey(key = "solver.name"); regex = "me");
  type = $imgType
)

$finalArchiveContent = ea.l.allCsv(
  path = $basePath + "me-lasts.txt";
  individualFunctions = [
  	  f.gridCompactness(of = ea.f.solution());
  	  f.gridElongation(of = ea.f.solution());
  	  ea.function.meBin(of = f.nTh(n = 0; of = ea.f.meCoordinates()));
  	  ea.function.meBin(of = f.nTh(n = 1; of = ea.f.meCoordinates()));
  	  f.composition(of = ea.f.solution(); then = $stringF)
  ];
  runFunctions = [
    f.mappableKey(key = "problem.target");
    f.mappableKey(key = "solver.mapper.grammar.name")
  ];
  runCondition = predicate.matches(f = f.mappableKey(key = "solver.name"); regex = "me");
  onlyLast = true
)
